name: Publish Release

on:
  push:
    tags:
      - 'v*.*.*'                 # ä»…å¯¹vå¼€å¤´çš„è¯­ä¹‰åŒ–ç‰ˆæœ¬æ ‡ç­¾è§¦å‘

jobs:
  publish:
    runs-on: ubuntu-latest
    permissions:
      contents: write            # å…è®¸åˆ›å»ºå·¥ä½œæµ

    steps:
      - name: ğŸ›ï¸ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 0         # è·å–å®Œæ•´å†å²ï¼Œç¡®ä¿æ ‡ç­¾å­˜åœ¨

      - name: ğŸ“¦ åˆ›å»ºå‘å¸ƒåŒ…ï¼ˆåº”ç”¨.gitattributesè§„åˆ™ï¼‰
        run: |
          TAG_NAME="${GITHUB_REF#refs/tags/}"
          # æ ¸å¿ƒï¼šä½¿ç”¨git archiveï¼Œå®ƒä¼šè‡ªåŠ¨åº”ç”¨.gitattributesä¸­çš„export-ignoreè§„åˆ™
          git archive --format=zip -o "dongliTV-$TAG_NAME.zip" HEAD
          echo "ASSET_PATH=dongliTV-$TAG_NAME.zip" >> $GITHUB_ENV

      - name: ğŸš€ åˆ›å»ºGitHub Releaseå¹¶ä¸Šä¼ èµ„äº§
        uses: softprops/action-gh-release@v1
        with:
          generate_release_notes: true    # è‡ªåŠ¨ç”Ÿæˆæ›´æ–°æ—¥å¿—
          draft: false
          prerelease: false
          files: |
            ${{ env.ASSET_PATH }}         # ä¸Šä¼ æˆ‘ä»¬è‡ªå®šä¹‰çš„ZIPåŒ…
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}